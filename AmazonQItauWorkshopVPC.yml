AWSTemplateFormatVersion: '2010-09-09'
Description: Plantilla de CloudFormation para desplegar una tabla DynamoDB y un contenedor en Fargate con un ALB en diferentes subredes.

Resources:
  VPC:
    Type: AWS::EC2::VPC
    Properties:
      CidrBlock: 10.0.0.0/16
      EnableDnsSupport: true
      EnableDnsHostnames: true
  InternetGateway:
    Type: AWS::EC2::InternetGateway
  AttachGateway:
    Type: AWS::EC2::VPCGatewayAttachment
    Properties:
      VpcId: !Ref VPC
      InternetGatewayId: !Ref InternetGateway
  SubnetA:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref VPC
      CidrBlock: 10.0.1.0/24
      AvailabilityZone: !Select
        - 0
        - !GetAZs ''
      MapPublicIpOnLaunch: true
  SubnetB:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref VPC
      CidrBlock: 10.0.2.0/24
      AvailabilityZone: !Select
        - 1
        - !GetAZs ''
      MapPublicIpOnLaunch: true
  SubnetPrivateA:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref VPC
      CidrBlock: 10.0.3.0/24
      AvailabilityZone: !Select
        - 0
        - !GetAZs ''
      MapPublicIpOnLaunch: false
  SubnetPrivateB:
    Type: AWS::EC2::Subnet
    Properties:
      VpcId: !Ref VPC
      CidrBlock: 10.0.4.0/24
      AvailabilityZone: !Select
        - 1
        - !GetAZs ''
      MapPublicIpOnLaunch: false
  RouteTable:
    Type: AWS::EC2::RouteTable
    Properties:
      VpcId: !Ref VPC
  DefaultRoute:
    Type: AWS::EC2::Route
    Properties:
      RouteTableId: !Ref RouteTable
      DestinationCidrBlock: 0.0.0.0/0
      GatewayId: !Ref InternetGateway
  SubnetARouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref SubnetA
      RouteTableId: !Ref RouteTable
  SubnetBRouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref SubnetB
      RouteTableId: !Ref RouteTable
  SubnetPrivateARouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref SubnetPrivateA
      RouteTableId: !Ref RouteTable
  SubnetPrivateBRouteTableAssociation:
    Type: AWS::EC2::SubnetRouteTableAssociation
    Properties:
      SubnetId: !Ref SubnetPrivateB
      RouteTableId: !Ref RouteTable
  DynamoDBTable:
    Type: AWS::DynamoDB::Table
    Properties:
      TableName: mutant
      AttributeDefinitions:
        - AttributeName: id
          AttributeType: S
        - AttributeName: dna
          AttributeType: S
      KeySchema:
        - AttributeName: id
          KeyType: HASH
        - AttributeName: dna
          KeyType: RANGE
      ProvisionedThroughput:
        ReadCapacityUnits: 5
        WriteCapacityUnits: 5
Outputs:
  VPCId:
    Description: The VPC ID
    Value: !Ref VPC
    Export:
        Name: 'workshop-pragma-VPCId'
  PublicSubnet1:
    Description: The Public Subnet 1
    Value: !Ref SubnetA
    Export:
        Name: 'workshop-pragma-PublicSubnet1'
  PublicSubnet2:
    Description: The Public Subnet 2
    Value: !Ref SubnetB
    Export:
        Name: 'workshop-pragma-PublicSubnet2'
  PrivateSubnet1:
    Description: The Private Subnet 1
    Value: !Ref SubnetPrivateA
    Export:
        Name: 'workshop-pragma-PrivateSubnet1'
  PrivateSubnet2:
    Description: The Private Subnet 2
    Value: !Ref SubnetPrivateB
    Export:
        Name: 'workshop-pragma-PrivateSubnet2'
Transform: AWS::Serverless-2016-10-31